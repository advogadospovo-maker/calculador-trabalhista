<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Acordo Trabalhista Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: var(--card); padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { color: var(--primary); margin-bottom: 1.5rem; text-align: center; }
        .section-title { border-bottom: 2px solid #e2e8f0; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; font-weight: bold; color: #64748b; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.2rem; margin-bottom: 1rem; }
        .field { display: flex; flex-direction: column; }
        label { font-weight: 600; font-size: 0.85rem; margin-bottom: 0.5rem; }
        input, select { padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 8px; }
        .dynamic-list { background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .check-item { display: flex; align-items: center; justify-content: space-between; padding: 8px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        .btn { width: 100%; padding: 1rem; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; margin-top: 10px; }
        .btn-calc { background: var(--primary); color: white; }
        .btn-pdf { background: var(--secondary); color: white; display: none; }
        .result-box { margin-top: 2rem; display: none; background: #fff; border: 2px solid var(--primary); padding: 1.5rem; border-radius: 12px; }
        .total-geral { font-size: 1.4rem; font-weight: 800; color: var(--primary); border-top: 2px solid #e2e8f0; margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between; }
        .hist-row { display: grid; grid-template-columns: 1fr 1fr 1fr 40px; gap: 10px; margin-bottom: 8px; }
    </style>
</head>
<body>
<div class="container">
    <h2>ü§ù Acordo Extrajudicial Inteligente</h2>
    <div class="grid">
        <div class="field"><label>Data Admiss√£o</label><input type="date" id="dataAdmissao" onchange="gerarPeriodos()"></div>
        <div class="field"><label>Data Demiss√£o</label><input type="date" id="dataDemissao" onchange="gerarPeriodos()"></div>
        <div class="field">
            <label>Recebia M√≠nimo?</label>
            <div style="display:flex; gap:10px; padding-top:10px;">
                <input type="radio" name="tipoSal" value="sim" checked onchange="toggleHist()"> Sim
                <input type="radio" name="tipoSal" value="nao" onchange="toggleHist()"> N√£o
            </div>
        </div>
        <div class="field">
            <label>Insalubridade (%)</label>
            <select id="insalubridadePerc" onchange="gerarPeriodos()">
                <option value="0">0%</option><option value="0.10">10%</option><option value="0.20" selected>20%</option><option value="0.40">40%</option>
            </select>
        </div>
    </div>

    <div id="secaoManual" style="display:none;" class="dynamic-list">
        <label>Hist√≥rico Salarial Manual</label>
        <div id="listaSalarial">
            <div class="hist-row">
                <input type="date" class="h-ini"> <input type="date" class="h-fim"> <input type="number" class="h-val" placeholder="R$">
                <button onclick="addLinha()" style="background:var(--primary); color:white; border:none; border-radius:4px;">+</button>
            </div>
        </div>
    </div>

    <div id="areaPeriodos" style="display:none;">
        <div class="section-title">‚öñÔ∏è Verbas Pendentes</div>
        <div id="listaFerias" class="dynamic-list"></div>
        <div id="lista13" class="dynamic-list"></div>
        <div id="listaIndenizacoes" class="dynamic-list"></div>
    </div>

    <button class="btn btn-calc" onclick="calcularTudo()">Calcular Acordo</button>
    <button class="btn btn-pdf" id="btnPDF">üìÑ Exportar PDF</button>

    <div class="result-box" id="resultado">
        <div id="detalhe-calculo"></div>
        <div class="total-geral"><span>TOTAL</span><span id="res-total">R$ 0,00</span></div>
    </div>
</div>
<body>

<div class="container">
    <h2>ü§ù Calculadora de Acordo Extrajudicial</h2>
    <div class="grid">
        <div class="field"><label>Admiss√£o</label><input type="date" id="dataAdmissao" onchange="gerarPeriodos()"></div>
        <div class="field"><label>Demiss√£o</label><input type="date" id="dataDemissao" onchange="gerarPeriodos()"></div>
        <div class="field">
    <label>Recebia Sal√°rio M√≠nimo?</label>
    <div style="display: flex; gap: 15px; margin-top: 5px;">
        <label style="flex-direction: row; gap: 5px;"><input type="radio" name="tipoSalario" value="minimo" checked onchange="toggleHistorico()"> Sim</label>
        <label style="flex-direction: row; gap: 5px;"><input type="radio" name="tipoSalario" value="manual" onchange="toggleHistorico()"> N√£o</label>
    </div>
</div>

<div id="secaoHistorico" style="display: none; margin-top: 1rem;" class="dynamic-list">
    <label>Hist√≥rico Salarial (Informe os per√≠odos e valores)</label>
    <div id="listaSalarial">
        <div class="grid" style="grid-template-columns: 1fr 1fr 1fr 0.2fr; margin-bottom: 5px;">
            <input type="date" class="hist-inicio">
            <input type="date" class="hist-fim">
            <input type="number" class="hist-valor" placeholder="Valor R$">
            <button onclick="addLinhaSalario()" style="background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer;">+</button>
        </div>
    </div>
</div>
        <div class="field"><label>Insalubridade (%)</label>
            <select id="insalubridadePerc" onchange="gerarPeriodos()">
                <option value="0">0%</option><option value="0.10">10%</option><option value="0.20" selected>20%</option><option value="0.40">40%</option>
            </select>
        </div>
    </div>

    <div id="areaPeriodos" style="display:none;">
        <div class="section-title">‚öñÔ∏è Itens Pendentes</div>
        <div id="listaVerbas" class="dynamic-list"></div>
        <div id="listaIndenizacoes" class="dynamic-list"></div>
    </div>

    <div class="actions">
        <button class="btn btn-calc" onclick="calcularTudo()">Calcular Acordo</button>
        <button class="btn btn-pdf" id="btnPDF">üìÑ Exportar PDF</button>
    </div>

    <div class="result-box" id="resultado">
        <div id="detalhe-calculo"></div>
        <div class="result-item total-geral"><span>TOTAL</span><span id="res-total">R$ 0,00</span></div>
    </div>
</div>

<script>
    const MINIMO_2026 = 1621.00; //
    const TABELA_MINIMO = { 2024: 1412, 2025: 1518, 2026: 1552 };

    function toggleHist() {
        const isManual = document.querySelector('input[name="tipoSal"][value="nao"]').checked;
        document.getElementById('secaoManual').style.display = isManual ? 'block' : 'none';
        gerarPeriodos();
    }

    function addLinha() {
        const div = document.createElement('div'); div.className = 'hist-row';
        div.innerHTML = `<input type="date" class="h-ini"> <input type="date" class="h-fim"> <input type="number" class="h-val" placeholder="R$"><button onclick="this.parentElement.remove()" style="background:#ef4444; color:white; border:none; border-radius:4px;">x</button>`;
        document.getElementById('listaSalarial').appendChild(div);
    }

    function obterSalarioNaData(data) {
        const isMinimo = document.querySelector('input[name="tipoSal"][value="sim"]').checked;
        if (isMinimo) return TABELA_MINIMO[data.getFullYear()] || MINIMO_2026;
        
        let valorEncontrado = 0;
        document.querySelectorAll('.hist-row').forEach(row => {
            const ini = new Date(row.querySelector('.h-ini').value);
            const fim = new Date(row.querySelector('.h-fim').value);
            const val = parseFloat(row.querySelector('.h-val').value);
            if (data >= ini && data <= fim) valorEncontrado = val;
        });
        return valorEncontrado || 0;
    }

    function gerarPeriodos() {
        const adm = new Date(document.getElementById('dataAdmissao').value + "T00:00:00");
        const dem = new Date(document.getElementById('dataDemissao').value + "T00:00:00");
        if (isNaN(adm) || isNaN(dem) || dem <= adm) return;

        const percIns = parseFloat(document.getElementById('insalubridadePerc').value);
        const insMensal = MINIMO_2026 * percIns; //
        
        document.getElementById('areaPeriodos').style.display = 'block';
        const lf = document.getElementById('listaFerias'); const l13 = document.getElementById('lista13'); const li = document.getElementById('listaIndenizacoes');
        lf.innerHTML = ""; l13.innerHTML = ""; li.innerHTML = "";

        // F√©rias com M√©dia Salarial do Per√≠odo
        let cursor = new Date(adm);
        while (cursor < dem) {
            let fimP = new Date(cursor); fimP.setFullYear(fimP.getFullYear() + 1); fimP.setDate(fimP.getDate() - 1);
            let salRef = obterSalarioNaData(fimP <= dem ? fimP : dem);
            let base = salRef + insMensal;
            let val = (fimP <= dem) ? base * 1.3333 : (base/12 * (Math.floor((dem-cursor)/(1000*60*60*24*30.44)) + (dem.getDate()>=15?1:0))) * 1.3333;
            if(val > 0) criarItemCheck(lf, `F√©rias ${cursor.getFullYear()}/${fimP.getFullYear()}`, val);
            cursor.setFullYear(cursor.getFullYear() + 1);
        }

        // 13¬∫ Sal√°rio
        for(let a=adm.getFullYear(); a<=dem.getFullYear(); a++) {
            let m = (a==dem.getFullYear()) ? dem.getMonth()+(dem.getDate()>=15?1:0) : (a==adm.getFullYear() ? 12-adm.getMonth() : 12);
            let base = obterSalarioNaData(new Date(a, 11, 1)) + insMensal;
            if(m > 0) criarItemCheck(l13, `13¬∫ Sal√°rio ${a} (${m}/12)`, (base/12)*m);
        }

        // Saldo de Sal√°rio e Indeniza√ß√µes
        const salFim = obterSalarioNaData(dem) + insMensal;
        criarItemCheck(li, `Saldo de Sal√°rio (${dem.getDate()} dias)`, (salFim/30)*dem.getDate());
        const anos = Math.floor((dem-adm)/31536000000);
        criarItemCheck(li, `Aviso Pr√©vio (${Math.min(30+(anos*3),90)} dias)`, (salFim/30)*Math.min(30+(anos*3),90));
        const fgts = (salFim * 0.08) * Math.round((dem-adm)/2629746000);
        criarItemCheck(li, "FGTS Estimado", fgts);
        criarItemCheck(li, "Multa FGTS (40%)", fgts * 0.4);
    }

    function criarItemCheck(c, l, v) {
        const d = document.createElement('div'); d.className = 'check-item';
        d.innerHTML = `<span><input type="checkbox" data-valor="${v}" data-label="${l}" checked> ${l}</span><b>R$ ${v.toFixed(2)}</b>`;
        c.appendChild(d);
    }

    function calcularTudo() {
        let t = 0; let h = ""; 
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(i => {
            const v = parseFloat(i.dataset.valor);
            t += v; h += `<div class="check-item"><span>${i.dataset.label}</span><span>R$ ${v.toFixed(2)}</span></div>`;
        });
        document.getElementById('detalhe-calculo').innerHTML = h;
        document.getElementById('res-total').innerText = t.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('resultado').style.display = 'block';
        document.getElementById('btnPDF').style.display = 'block';
    }
</script>
</body>
</html>
</body>
</html>