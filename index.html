<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Acordo Trabalhista Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: var(--card); padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { color: var(--primary); margin-bottom: 1.5rem; text-align: center; }
        .section-title { border-bottom: 2px solid #e2e8f0; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; font-weight: bold; color: #64748b; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.2rem; margin-bottom: 1rem; }
        .field { display: flex; flex-direction: column; }
        label { font-weight: 600; font-size: 0.85rem; margin-bottom: 0.5rem; }
        input, select { padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; }
        .dynamic-list { background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .check-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        .check-item:last-child { border-bottom: none; }
        .check-item input { margin-right: 12px; width: 20px; height: 20px; cursor: pointer; }
        .actions { margin-top: 2rem; display: flex; flex-direction: column; gap: 10px; }
        .btn { width: 100%; padding: 1rem; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-calc { background: var(--primary); color: white; }
        .btn-pdf { background: var(--secondary); color: white; display: none; }
        .result-box { margin-top: 2rem; display: none; background: #fff; border: 2px solid var(--primary); padding: 1.5rem; border-radius: 12px; }
        .result-item { display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #f1f5f9; }
        .total-geral { font-size: 1.5rem; font-weight: 800; color: var(--primary); border-top: 2px solid #e2e8f0; margin-top: 10px; padding-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ü§ù Calculadora de Acordo Extrajudicial</h2>
    <div class="grid">
        <div class="field"><label>Admiss√£o</label><input type="date" id="dataAdmissao" onchange="gerarPeriodos()"></div>
        <div class="field"><label>Demiss√£o</label><input type="date" id="dataDemissao" onchange="gerarPeriodos()"></div>
        <div class="field"><label>Sal√°rio Base (R$)</label><input type="number" id="salario" value="2500" onchange="gerarPeriodos()"></div>
        <div class="field"><label>Insalubridade (%)</label>
            <select id="insalubridadePerc" onchange="gerarPeriodos()">
                <option value="0">0%</option><option value="0.10">10%</option><option value="0.20" selected>20%</option><option value="0.40">40%</option>
            </select>
        </div>
    </div>

    <div id="areaPeriodos" style="display:none;">
        <div class="section-title">‚öñÔ∏è Itens Pendentes</div>
        <div id="listaVerbas" class="dynamic-list"></div>
        <div id="listaIndenizacoes" class="dynamic-list"></div>
    </div>

    <div class="actions">
        <button class="btn btn-calc" onclick="calcularTudo()">Calcular Acordo</button>
        <button class="btn btn-pdf" id="btnPDF">üìÑ Exportar PDF</button>
    </div>

    <div class="result-box" id="resultado">
        <div id="detalhe-calculo"></div>
        <div class="result-item total-geral"><span>TOTAL</span><span id="res-total">R$ 0,00</span></div>
    </div>
</div>

<script>
    const SALARIO_MINIMO_2026 = 1552.00;
    let itensSelecionados = [];

    function gerarPeriodos() {
        const adm = new Date(document.getElementById('dataAdmissao').value + "T00:00:00");
        const dem = new Date(document.getElementById('dataDemissao').value + "T00:00:00");
        if (isNaN(adm) || isNaN(dem) || dem <= adm) return;

        const percIns = parseFloat(document.getElementById('insalubridadePerc').value);
        const baseCalculo = parseFloat(document.getElementById('salario').value) + (SALARIO_MINIMO_2026 * percIns);
        
        document.getElementById('areaPeriodos').style.display = 'block';
        const lv = document.getElementById('listaVerbas');
        const li = document.getElementById('listaIndenizacoes');
        lv.innerHTML = ""; li.innerHTML = "";

        // F√©rias
        let cursor = new Date(adm);
        while (cursor < dem) {
            let fim = new Date(cursor); fim.setFullYear(fim.getFullYear() + 1); fim.setDate(fim.getDate() - 1);
            let val = (fim <= dem) ? baseCalculo * 1.3333 : (baseCalculo / 12 * Math.min(12, Math.floor((dem - cursor) / 2629746000) + (dem.getDate() >= 15 ? 1 : 0))) * 1.3333;
            if(val > 0) criarItem(lv, `F√©rias ${cursor.getFullYear()}/${fim.getFullYear()}`, val);
            cursor.setFullYear(cursor.getFullYear() + 1);
        }

        // 13¬∫
        for(let a = adm.getFullYear(); a <= dem.getFullYear(); a++) {
            let m = (a === dem.getFullYear()) ? dem.getMonth() + (dem.getDate() >= 15 ? 1 : 0) : (a === adm.getFullYear() ? 12 - adm.getMonth() : 12);
            if(m > 0) criarItem(lv, `13¬∫ Sal√°rio ${a}`, (baseCalculo / 12) * m);
        }

        // Aviso e FGTS
        const anos = Math.floor((dem - adm) / 31557600000);
        criarItem(li, `Aviso Pr√©vio (${Math.min(30 + (anos * 3), 90)} dias)`, (baseCalculo / 30) * Math.min(30 + (anos * 3), 90));
        const fgts = (baseCalculo * 0.08) * Math.round((dem - adm) / 2629746000);
        criarItem(li, "FGTS Estimado", fgts);
        criarItem(li, "Multa FGTS (40%)", fgts * 0.4);
    }

    function criarItem(c, l, v) {
        const d = document.createElement('div'); d.className = 'check-item';
        d.innerHTML = `<span><input type="checkbox" data-valor="${v}" data-label="${l}" checked> ${l}</span><b>R$ ${v.toFixed(2)}</b>`;
        c.appendChild(d);
    }

    function calcularTudo() {
        let t = 0; let h = ""; itensSelecionados = [];
        document.querySelectorAll('input[type="checkbox"]:checked').forEach(i => {
            const val = parseFloat(i.dataset.valor);
            t += val; h += `<div class="result-item"><span>${i.dataset.label}</span><span>R$ ${val.toFixed(2)}</span></div>`;
            itensSelecionados.push({l: i.dataset.label, v: val});
        });
        document.getElementById('detalhe-calculo').innerHTML = h;
        document.getElementById('res-total').innerText = t.toLocaleString('pt-BR', {style:'currency', currency:'BRL'});
        document.getElementById('resultado').style.display = 'block';
        document.getElementById('btnPDF').style.display = 'block';
    }

    document.getElementById('btnPDF').onclick = () => {
        const { jsPDF } = window.jspdf; const doc = new jsPDF(); let y = 40;
        doc.setFont("helvetica", "bold"); doc.text("RESUMO DO ACORDO", 105, 20, {align:"center"});
        doc.setFontSize(10); doc.setFont("helvetica", "normal");
        itensSelecionados.forEach(i => { doc.text(i.l, 20, y); doc.text(`R$ ${i.v.toFixed(2)}`, 150, y); y += 10; });
        doc.text("TOTAL:", 20, y+10); doc.text(document.getElementById('res-total').innerText, 150, y+10);
        doc.save("acordo.pdf");
    };
</script>
</body>
</html>