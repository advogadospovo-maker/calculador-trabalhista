<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Acordo Trabalhista Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { 
            --primary: #2563eb; 
            --secondary: #10b981;
            --bg: #f8fafc; 
            --card: #ffffff; 
            --text: #1e293b;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); 
            color: var(--text); 
            padding: 20px; 
            line-height: 1.5;
        }

        .container { 
            max-width: 850px; 
            margin: 0 auto; 
            background: var(--card); 
            padding: 2.5rem; 
            border-radius: 16px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
        }

        h2 { color: var(--primary); margin-bottom: 1.5rem; text-align: center; }

        .section-title { 
            border-bottom: 2px solid #e2e8f0; 
            margin: 1.5rem 0 1rem; 
            padding-bottom: 0.5rem; 
            font-weight: bold;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 1.2rem; 
            margin-bottom: 1rem; 
        }

        .field { display: flex; flex-direction: column; }
        
        label { font-weight: 600; font-size: 0.85rem; margin-bottom: 0.5rem; color: #475569; }

        input, select { 
            padding: 0.75rem; 
            border: 1px solid #cbd5e1; 
            border-radius: 8px; 
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus { outline: none; border-color: var(--primary); }

        .actions { margin-top: 2rem; display: flex; flex-direction: column; gap: 10px; }

        .btn { 
            width: 100%; 
            padding: 1rem; 
            border: none; 
            border-radius: 8px; 
            font-weight: bold; 
            cursor: pointer; 
            font-size: 1rem;
            transition: opacity 0.2s;
        }

        .btn-calc { background: var(--primary); color: white; }
        .btn-pdf { background: var(--secondary); color: white; display: none; }
        .btn:hover { opacity: 0.9; }

        .result-box { 
            margin-top: 2rem; 
            display: none; 
            background: #f1f5f9; 
            padding: 1.5rem; 
            border-radius: 12px; 
            border: 1px solid #e2e8f0;
        }

        .result-item { 
            display: flex; 
            justify-content: space-between; 
            padding: 0.75rem 0; 
            border-bottom: 1px solid #cbd5e1; 
        }

        .result-item:last-child { border-bottom: none; }

        .total-geral { 
            font-size: 1.4rem; 
            font-weight: 800; 
            color: var(--primary); 
            margin-top: 1rem; 
            padding-top: 1rem;
            border-top: 2px solid #cbd5e1;
        }

        .info-card {
            background: #eff6ff;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #1e40af;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="container">
    <h2>üìä Calculadora de Verbas Rescis√≥rias</h2>
    
    <div class="info-card">
        <strong>Regra de C√°lculo:</strong> A insalubridade √© calculada automaticamente sobre o sal√°rio m√≠nimo vigente (R$ 1.552,00). 
        As f√©rias e 13¬∫ j√° incluem o reflexo deste adicional.
    </div>

    <div class="section-title">üìÖ Per√≠odo do Contrato</div>
    <div class="grid">
        <div class="field">
            <label>Data de Admiss√£o</label>
            <input type="date" id="dataAdmissao">
        </div>
        <div class="field">
            <label>Data de Demiss√£o</label>
            <input type="date" id="dataDemissao">
        </div>
    </div>

    <div class="section-title">üí∞ Remunera√ß√£o e Adicionais</div>
    <div class="grid">
        <div class="field">
            <label>√öltimo Sal√°rio Base (R$)</label>
            <input type="number" id="salario" value="2500.00" step="0.01">
        </div>
        <div class="field">
            <label>Insalubridade</label>
            <select id="insalubridadePerc">
                <option value="0">N√£o possui</option>
                <option value="0.10">M√≠nimo (10%)</option>
                <option value="0.20" selected>M√©dio (20%)</option>
                <option value="0.40">M√°ximo (40%)</option>
            </select>
        </div>
    </div>

    <div class="actions">
        <button class="btn btn-calc" id="btnCalcular">Calcular Verbas Brutas</button>
        <button class="btn btn-pdf" id="btnPDF">üìÑ Gerar Relat√≥rio PDF</button>
    </div>

    <div class="result-box" id="resultado">
        <h3>Resumo das Verbas</h3>
        <div id="lista-resultados"></div>
        <div class="result-item total-geral">
            <span>TOTAL BRUTO</span>
            <span id="res-total">R$ 0,00</span>
        </div>
    </div>
</div>

<script>
    // Configura√ß√µes Globais
    const SALARIO_MINIMO_2026 = 1552.00;

    document.addEventListener('DOMContentLoaded', () => {
        const btnCalcular = document.getElementById('btnCalcular');
        const btnPDF = document.getElementById('btnPDF');
        let relatorioGlobal = null;

        btnCalcular.addEventListener('click', () => {
            const admVal = document.getElementById('dataAdmissao').value;
            const demVal = document.getElementById('dataDemissao').value;
            const salarioBase = parseFloat(document.getElementById('salario').value);
            const percIns = parseFloat(document.getElementById('insalubridadePerc').value);

            if (!admVal || !demVal) {
                alert("Por favor, selecione as datas de admiss√£o e demiss√£o.");
                return;
            }

            const dataAdm = new Date(admVal);
            const dataDem = new Date(demVal);

            if (dataDem < dataAdm) {
                alert("A data de demiss√£o n√£o pode ser anterior √† admiss√£o.");
                return;
            }

            // --- C√ÅLCULOS L√ìGICOS ---

            // 1. Tempo de Servi√ßo (Meses para fins de Proporcionalidade)
            const diffAnos = dataDem.getFullYear() - dataAdm.getFullYear();
            const mesesContrato = (diffAnos * 12) + (dataDem.getMonth() - dataAdm.getMonth());
            const diasUltimoMes = dataDem.getDate();
            const mesesProporcionais = diasUltimoMes >= 15 ? mesesContrato + 1 : mesesContrato;

            // 2. Insalubridade Autom√°tica
            const valorInsMensal = SALARIO_MINIMO_2026 * percIns;
            const insalubridadeTotal = valorInsMensal * mesesContrato;

            // 3. Base de C√°lculo (Sal√°rio + Adicional)
            const baseCalculo = salarioBase + valorInsMensal;

            // 4. F√©rias + 1/3 (Considerando meses trabalhados)
            const feriasProporcional = (baseCalculo / 12) * mesesProporcionais;
            const feriasTotalTer√ßo = feriasProporcional * 1.3333;

            // 5. 13¬∫ Sal√°rio (Considerando meses do ano civil da demiss√£o)
            const mesesAnoAtual = dataDem.getMonth() + 1;
            const decimoTerceiro = (baseCalculo / 12) * mesesAnoAtual;

            // 6. Aviso Pr√©vio (Lei 12.506/11)
            const anosCompletos = Math.floor(mesesContrato / 12);
            const diasAviso = 30 + (anosCompletos * 3);
            const valorAviso = (baseCalculo / 30) * Math.min(diasAviso, 90);

            // 7. FGTS e Multa
            const saldoFGTS_Estimado = (baseCalculo * 0.08) * mesesContrato;
            const multa40 = saldoFGTS_Estimado * 0.40;

            const totalGeral = insalubridadeTotal + feriasTotalTer√ßo + decimoTerceiro + valorAviso + saldoFGTS_Estimado + multa40;

            // Guardar para o PDF
            relatorioGlobal = {
                adm: admVal.split('-').reverse().join('/'),
                dem: demVal.split('-').reverse().join('/'),
                salario: salarioBase,
                insalubridade: insalubridadeTotal,
                ferias: feriasTotalTer√ßo,
                decimo: decimoTerceiro,
                aviso: valorAviso,
                fgts: saldoFGTS_Estimado,
                multa: multa40,
                total: totalGeral,
                diasAviso: Math.min(diasAviso, 90)
            };

            renderizarResultados(relatorioGlobal);
        });

        function renderizarResultados(dados) {
            const lista = document.getElementById('lista-resultados');
            document.getElementById('resultado').style.display = 'block';
            btnPDF.style.display = 'block';

            lista.innerHTML = `
                <div class="result-item"><span>Insalubridade Acumulada</span> <span>R$ ${dados.insalubridade.toFixed(2)}</span></div>
                <div class="result-item"><span>F√©rias Proporcionais + 1/3</span> <span>R$ ${dados.ferias.toFixed(2)}</span></div>
                <div class="result-item"><span>13¬∫ Sal√°rio Proporcional</span> <span>R$ ${dados.decimo.toFixed(2)}</span></div>
                <div class="result-item"><span>Aviso Pr√©vio (${dados.diasAviso} dias)</span> <span>R$ ${dados.aviso.toFixed(2)}</span></div>
                <div class="result-item"><span>Saldo FGTS Estimado</span> <span>R$ ${dados.fgts.toFixed(2)}</span></div>
                <div class="result-item"><span>Multa FGTS (40%)</span> <span>R$ ${dados.multa.toFixed(2)}</span></div>
            `;

            document.getElementById('res-total').innerText = dados.total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        // Fun√ß√£o de PDF
        btnPDF.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFont("helvetica", "bold");
            doc.text("MEMORIAL DE C√ÅLCULO TRABALHISTA", 105, 20, { align: "center" });
            
            doc.setFontSize(10);
            doc.setFont("helvetica", "normal");
            doc.text(`Per√≠odo: ${relatorioGlobal.adm} at√© ${relatorioGlobal.dem}`, 20, 35);
            doc.text(`Sal√°rio Base: R$ ${relatorioGlobal.salario.toFixed(2)}`, 20, 42);
            
            doc.setLineWidth(0.5);
            doc.line(20, 48, 190, 48);

            let y = 60;
            const itens = [
                ["Adicional de Insalubridade", relatorioGlobal.insalubridade],
                ["F√©rias + Ter√ßo Constitucional", relatorioGlobal.ferias],
                ["13¬∫ Sal√°rio Proporcional", relatorioGlobal.decimo],
                ["Aviso Pr√©vio Indenizado", relatorioGlobal.aviso],
                ["FGTS (Dep√≥sitos do per√≠odo)", relatorioGlobal.fgts],
                ["Multa Indenizat√≥ria (40%)", relatorioGlobal.multa]
            ];

            itens.forEach(item => {
                doc.text(item[0], 20, y);
                doc.text(`R$ ${item[1].toFixed(2)}`, 150, y);
                y += 10;
            });

            doc.setFont("helvetica", "bold");
            doc.setFontSize(12);
            doc.text("VALOR TOTAL PARA ACORDO:", 20, y + 15);
            doc.text(`R$ ${relatorioGlobal.total.toFixed(2)}`, 150, y + 15);

            doc.setFontSize(8);
            doc.setFont("helvetica", "italic");
            doc.text("Este documento √© uma estimativa para fins de negocia√ß√£o extrajudicial.", 105, 280, { align: "center" });

            doc.save(`Acordo_${relatorioGlobal.dem.replace(/\//g, '-')}.pdf`);
        });
    });
</script>

</body>
</html>