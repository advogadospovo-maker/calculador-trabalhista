<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Acordo Trabalhista</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #2563eb; --secondary: #10b981; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: var(--card); padding: 2rem; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { color: var(--primary); margin-bottom: 1.5rem; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .section-title { border-bottom: 2px solid #e2e8f0; margin: 1.5rem 0 1rem; padding-bottom: 0.5rem; font-weight: bold; color: #64748b; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.2rem; margin-bottom: 1rem; }
        .field { display: flex; flex-direction: column; }
        label { font-weight: 600; font-size: 0.85rem; margin-bottom: 0.5rem; }
        input, select { padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; }
        .dynamic-list { background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .check-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        .check-item:last-child { border-bottom: none; }
        .check-item input { margin-right: 12px; width: 20px; height: 20px; cursor: pointer; }
        .btn { width: 100%; padding: 1rem; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 1rem; margin-top: 10px; }
        .btn-calc { background: var(--primary); color: white; }
        .btn-pdf { background: var(--secondary); color: white; display: none; }
        .result-box { margin-top: 2rem; display: none; background: #fff; border: 2px solid var(--primary); padding: 1.5rem; border-radius: 12px; }
        .total-geral { font-size: 1.5rem; font-weight: 800; color: var(--primary); border-top: 2px solid #e2e8f0; margin-top: 10px; padding-top: 10px; display: flex; justify-content: space-between; }
        .hist-row { display: grid; grid-template-columns: 1fr 1fr 1fr 45px; gap: 10px; margin-bottom: 8px; align-items: end; }
    </style>
</head>
<body>

<div class="container">
    <h2>ü§ù Calculadora de Acordo Trabalhista Inteligente</h2>
    
    <div class="grid">
        <div class="field"><label>Data de Admiss√£o</label><input type="date" id="dataAdmissao" onchange="gerarPeriodos()"></div>
        <div class="field"><label>Data de Demiss√£o</label><input type="date" id="dataDemissao" onchange="gerarPeriodos()"></div>
        <div class="field">
            <label>Recebia Sal√°rio M√≠nimo?</label>
            <div style="display: flex; gap: 15px; padding-top: 10px;">
                <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;"><input type="radio" name="tipoSal" value="sim" checked onchange="toggleHistorico()"> Sim</label>
                <label style="font-weight: normal; display: flex; align-items: center; gap: 5px;"><input type="radio" name="tipoSal" value="nao" onchange="toggleHistorico()"> N√£o</label>
            </div>
        </div>
        <div class="field">
            <label>Insalubridade (%)</label>
            <select id="insalubridadePerc" onchange="gerarPeriodos()">
                <option value="0">N√£o possui</option>
                <option value="0.10">10% (M√≠nimo)</option>
                <option value="0.20" selected>20% (M√©dio)</option>
                <option value="0.40">40% (M√°ximo)</option>
            </select>
        </div>
    </div>

    <div id="secaoManual" style="display: none;" class="dynamic-list">
        <label>Hist√≥rico Salarial Manual (Per√≠odo e Valor)</label>
        <div id="listaSalarial">
            <div class="hist-row">
                <div class="field"><label>De</label><input type="date" class="h-ini" onchange="gerarPeriodos()"></div>
                <div class="field"><label>At√©</label><input type="date" class="h-fim" onchange="gerarPeriodos()"></div>
                <div class="field"><label>Sal√°rio R$</label><input type="number" class="h-val" placeholder="0.00" onchange="gerarPeriodos()"></div>
                <button onclick="addLinha()" class="btn" style="background: var(--primary); color: white; margin: 0; padding: 0.75rem;">+</button>
            </div>
        </div>
    </div>

    <div id="areaPeriodos" style="display:none;">
        <div class="section-title">‚öñÔ∏è Itens do Acordo (Marque o que entrar√° no c√°lculo)</div>
        <label>F√©rias e 13¬∫ Sal√°rios</label>
        <div id="listaVerbas" class="dynamic-list"></div>

        <label>Indeniza√ß√µes e FGTS</label>
        <div id="listaIndenizacoes" class="dynamic-list"></div>
    </div>

    <div class="actions">
        <button class="btn btn-calc" onclick="calcularTudo()">Gerar Memorial de C√°lculo</button>
        <button class="btn btn-pdf" id="btnPDF">üìÑ Exportar PDF para Assinatura(em desenvolvimento)</button>
    </div>

    <div class="result-box" id="resultado">
        <div id="detalhe-calculo"></div>
        <div class="total-geral">
            <span>VALOR TOTAL DO ACORDO</span>
            <span id="res-total">R$ 0,00</span>
        </div>
    </div>
</div>

<script>
    const MINIMO_2026 = 1552.00; // Conforme instru√ß√£o personalizada
    const TABELA_MINIMO = { 2024: 1412, 2025: 1518, 2026: 1552 };

    function toggleHistorico() {
        const manual = document.querySelector('input[name="tipoSal"][value="nao"]').checked;
        document.getElementById('secaoManual').style.display = manual ? 'block' : 'none';
        gerarPeriodos();
    }

    function addLinha() {
        const div = document.createElement('div');
        div.className = 'hist-row';
        div.innerHTML = `
            <div class="field"><input type="date" class="h-ini" onchange="gerarPeriodos()"></div>
            <div class="field"><input type="date" class="h-fim" onchange="gerarPeriodos()"></div>
            <div class="field"><input type="number" class="h-val" placeholder="0.00" onchange="gerarPeriodos()"></div>
            <button onclick="this.parentElement.remove(); gerarPeriodos();" class="btn" style="background:#ef4444; color:white; margin:0; padding:0.75rem;">x</button>
        `;
        document.getElementById('listaSalarial').appendChild(div);
    }

    function obterSalarioNaData(data) {
        const isMinimo = document.querySelector('input[name="tipoSal"][value="sim"]').checked;
        if (isMinimo) return TABELA_MINIMO[data.getFullYear()] || MINIMO_2026;
        
        let valor = 0;
        document.querySelectorAll('.hist-row').forEach(row => {
            const ini = new Date(row.querySelector('.h-ini').value + "T00:00:00");
            const fim = new Date(row.querySelector('.h-fim').value + "T00:00:00");
            const v = parseFloat(row.querySelector('.h-val').value);
            if (data >= ini && data <= fim) valor = v;
        });
        return valor;
    }

    function gerarPeriodos() {
        const admInput = document.getElementById('dataAdmissao').value;
        const demInput = document.getElementById('dataDemissao').value;
        if (!admInput || !demInput) return;

        const adm = new Date(admInput + "T00:00:00");
        const dem = new Date(demInput + "T00:00:00");
        const percIns = parseFloat(document.getElementById('insalubridadePerc').value);
        const insMensal = MINIMO_2026 * percIns; // Insalubridade autom√°tica sobre o m√≠nimo

        if (dem <= adm) return;

        document.getElementById('areaPeriodos').style.display = 'block';
        const lv = document.getElementById('listaVerbas');
        const li = document.getElementById('listaIndenizacoes');
        lv.innerHTML = ""; li.innerHTML = "";

        // 1. F√©rias
        let cursor = new Date(adm);
        while (cursor < dem) {
            let fimP = new Date(cursor);
            fimP.setFullYear(fimP.getFullYear() + 1);
            fimP.setDate(fimP.getDate() - 1);

            let salRef = obterSalarioNaData(fimP <= dem ? fimP : dem);
            let base = salRef + insMensal;
            
            let label, valor;
            if (fimP <= dem) {
                label = `F√©rias Integrais (${cursor.getFullYear()}/${fimP.getFullYear()})`;
                valor = base * 1.3333;
            } else {
                let meses = (dem.getFullYear() - cursor.getFullYear()) * 12 + (dem.getMonth() - cursor.getMonth());
                if (dem.getDate() >= 15) meses++;
                meses = Math.min(meses, 12);
                label = `F√©rias Proporcionais (${meses}/12 avos)`;
                valor = (base / 12 * meses) * 1.3333;
            }
            if(valor > 0) criarItem(lv, label, valor);
            cursor.setFullYear(cursor.getFullYear() + 1);
        }

        // 2. 13¬∫ Sal√°rio
        for (let a = adm.getFullYear(); a <= dem.getFullYear(); a++) {
            let m = (a == dem.getFullYear()) ? dem.getMonth() + (dem.getDate() >= 15 ? 1 : 0) : (a == adm.getFullYear() ? 12 - adm.getMonth() : 12);
            let base = obterSalarioNaData(new Date(a, 11, 1)) + insMensal;
            if (m > 0) criarItem(lv, `13¬∫ Sal√°rio ${a} (${m}/12)`, (base / 12) * m);
        }

        // 3. Saldo, Aviso e FGTS
        const salFim = obterSalarioNaData(dem) + insMensal;
        criarItem(li, `Saldo de Sal√°rio (${dem.getDate()} dias)`, (salFim / 30) * dem.getDate());
        
        const anos = Math.floor((dem - adm) / 31536000000);
        const diasAviso = Math.min(30 + (anos * 3), 90);
        criarItem(li, `Aviso Pr√©vio Indenizado (${diasAviso} dias)`, (salFim / 30) * diasAviso);

        const mesesFGTS = Math.round((dem - adm) / 2629746000);
        const fgts = (salFim * 0.08) * mesesFGTS;
        criarItem(li, `FGTS Estimado (${mesesFGTS} meses)`, fgts);
        criarItem(li, `Multa FGTS (40% do saldo)`, fgts * 0.40);
    }

    function criarItem(container, label, valor) {
        const div = document.createElement('div');
        div.className = 'check-item';
        div.innerHTML = `<span><input type="checkbox" data-valor="${valor}" data-label="${label}" checked> ${label}</span><b>R$ ${valor.toFixed(2)}</b>`;
        container.appendChild(div);
    }

    function calcularTudo() {
        let total = 0;
        let html = "<h3>Detalhamento das Verbas:</h3>";
        const checks = document.querySelectorAll('input[type="checkbox"]:checked');
        
        checks.forEach(i => {
            const v = parseFloat(i.dataset.valor);
            total += v;
            html += `<div class="check-item"><span>${i.dataset.label}</span><span>R$ ${v.toFixed(2)}</span></div>`;
        });

        document.getElementById('detalhe-calculo').innerHTML = html;
        document.getElementById('res-total').innerText = total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        document.getElementById('resultado').style.display = 'block';
        document.getElementById('btnPDF').style.display = 'block';
        window.scrollTo(0, document.body.scrollHeight);
    }
</script>
</body>
</html>

